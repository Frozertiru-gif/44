# Ремонт техники на дому — лендинг

Минималистичный одностраничный лендинг для лидогенерации. Mobile-first, три ключевых действия: позвонить, написать, оставить заявку.

## Почему выбран этот стек
- **Next.js (App Router) + TypeScript**: даёт быстрый старт, удобные API routes для формы и единый билд фронта/бэка без лишних зависимостей. Проект можно запускать как обычный сервер или деплоить на любой VPS. Статическая часть остаётся простой, а серверный маршрут `/api/lead` обеспечивает надёжную обработку заявок.

## Требования
- Node.js 18+
- npm

## Установка
```bash
npm install
```

## Переменные окружения
Скопируйте `.env.example` в `.env` и заполните значения:
```bash
cp .env.example .env
```

Обязательные параметры для отправки лидов напрямую в Telegram-чат:
- `LEADS_TG_BOT_TOKEN` — токен бота.
- `LEADS_TG_CHAT_ID` — ID чата (группа/канал), например `-1001234567890`.
- `LEADS_TG_PARSE_MODE` — режим разметки сообщений (по умолчанию `HTML`).

## Запуск (dev)
```bash
npm run dev
```

## Сборка
```bash
npm run build
```

## Запуск (prod)
```bash
npm run start
```

## Просмотр лидов
```bash
npm run leads:tail
```

## Хранение лидов
Лиды сохраняются в `data/leads.jsonl` в формате JSONL и логируются в консоль (включая `external_id`).

## Как получить `LEADS_TG_CHAT_ID`
1. Добавьте бота в нужный чат (группа/канал).
2. Отправьте любое сообщение в чат.
3. Откройте в браузере:
   `https://api.telegram.org/bot<TOKEN>/getUpdates`
4. Найдите в JSON поле `message.chat.id` (для каналов/супергрупп обычно начинается с `-100...`).
5. Укажите это значение в `LEADS_TG_CHAT_ID`.

## Деплой (быстрый вариант)
**VPS/Render/Fly:**
1. Установите Node.js 18+
2. Скопируйте репозиторий на сервер
3. Создайте `.env`
4. Выполните:
```bash
npm install
npm run build
npm run start
```
5. Прокиньте домен на порт `3000` через nginx/caddy (по желанию).

## Структура контента
Контент вынесен в `src/content/site.ts`, чтобы легко заменить тексты, категории и контакты без правки компонентов.

## Защита формы
- Honeypot поле
- Rate-limit: 5 запросов за 10 минут на IP
- Базовая валидация телефона

## События аналитики
Подготовлен хук `track()` в `src/lib/track.ts` для будущей интеграции аналитики.

## Резервное копирование PostgreSQL (Docker)

### Подготовка конфигурации
Скопируйте пример файла переменных и заполните пароль шифрования:
```bash
cp telegram_service/scripts/backup.env.example telegram_service/scripts/backup.env
```

### Ручной запуск бэкапа
```bash
/opt/master_stack/app/telegram_service/scripts/backup_db.sh
```

### Cron (пример)
```cron
15 3 * * * /opt/master_stack/app/telegram_service/scripts/backup_db.sh >> /var/log/backup_db.log 2>&1
```
