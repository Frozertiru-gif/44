# Ремонт техники на дому — лендинг

Минималистичный одностраничный лендинг для лидогенерации. Mobile-first, три ключевых действия: позвонить, написать, оставить заявку.

## Почему выбран этот стек
- **Next.js (App Router) + TypeScript**: даёт быстрый старт, удобные API routes для формы и единый билд фронта/бэка без лишних зависимостей. Проект можно запускать как обычный сервер или деплоить на любой VPS. Статическая часть остаётся простой, а серверный маршрут `/api/lead` обеспечивает надёжную обработку заявок.

## Требования
- Node.js 18+
- npm

## Установка
```bash
npm install
```

## Переменные окружения
Скопируйте `.env.example` в `.env` и заполните значения:
```bash
cp .env.example .env
```

Обязательные параметры для webhook-отправки заявок:
- `LEADS_WEBHOOK_URL` — URL вебхука telegram_service (пример: `https://<domain>/webhook/lead`).
- `LEADS_WEBHOOK_SECRET` — секрет для заголовка `X-Webhook-Secret`.

Опциональный fallback для старого Telegram-уведомления (по умолчанию выключен):
- `LEADS_TG_FALLBACK=1`
- `LEADS_TG_BOT_TOKEN`, `LEADS_TG_ADMIN_IDS`, `LEADS_TG_PARSE_MODE` — параметры старого пути.

## Запуск (dev)
```bash
npm run dev
```

## Сборка
```bash
npm run build
```

## Запуск (prod)
```bash
npm run start
```

## Просмотр лидов
```bash
npm run leads:tail
```

## Хранение лидов
Лиды сохраняются в `data/leads.jsonl` в формате JSONL и логируются в консоль (включая `external_id`).

## Проверка отправки webhook
1. Запустите telegram_service с настроенным `WEBHOOK_SECRET` и доступным портом вебхука.
2. Укажите `LEADS_WEBHOOK_URL` и `LEADS_WEBHOOK_SECRET` на ленде.
3. Отправьте тестовую заявку через форму на сайте.
4. Пользователь всегда получит `ok:true`, а доставка/ошибки будут в логах сервиса.

## Деплой (быстрый вариант)
**VPS/Render/Fly:**
1. Установите Node.js 18+
2. Скопируйте репозиторий на сервер
3. Создайте `.env`
4. Выполните:
```bash
npm install
npm run build
npm run start
```
5. Прокиньте домен на порт `3000` через nginx/caddy (по желанию).

## Структура контента
Контент вынесен в `src/content/site.ts`, чтобы легко заменить тексты, категории и контакты без правки компонентов.

## Защита формы
- Honeypot поле
- Rate-limit: 5 запросов за 10 минут на IP
- Базовая валидация телефона

## События аналитики
Подготовлен хук `track()` в `src/lib/track.ts` для будущей интеграции аналитики.
