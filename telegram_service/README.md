# Telegram Service Bot

–ë–∞–∑–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å Telegram-–±–æ—Ç–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ (tickets) —Å —Ä–æ–ª—è–º–∏ –∏ –ë–î.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker
- Docker Compose

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è.
2. –í docker-—Ä–µ–∂–∏–º–µ `DATABASE_URL` –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–∏—Å `db` –≤–Ω—É—Ç—Ä–∏ Compose:
   `postgresql+asyncpg://telegram:telegram@db:5432/telegram_service`.
3. –£–∫–∞–∂–∏—Ç–µ `SUPER_ADMIN` (–æ–¥–∏–Ω tg_id) –∏/–∏–ª–∏ `SYS_ADMIN_IDS` —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (tg_id –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤), —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ–ª—É—á–∏–ª–∏ —Ä–æ–ª–∏
   SUPER_ADMIN/SYS_ADMIN –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ `/start`.

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `BOT_TOKEN`
- `DATABASE_URL`
- `DB_SCHEMA` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `public`)
- `REQUESTS_CHAT_ID`
- `SUPER_ADMIN` –∏–ª–∏ `SYS_ADMIN_IDS` (–º–∏–Ω–∏–º—É–º –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

```bash
cd telegram_service
docker compose up -d --build
```

## –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

- `db` —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø–µ—Ä–≤—ã–º –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç healthcheck.
- `migrations` –∑–∞–ø—É—Å–∫–∞–µ—Ç `alembic upgrade head` –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –∫–æ–¥–æ–º 0.
- `bot` —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `migrations`.

## –õ–æ–≥–∏ –±–æ—Ç–∞

```bash
docker compose logs -f bot
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é

```bash
docker compose run --rm migrations
```

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker compose down
```

## –ü–æ–ª–Ω—ã–π —Ä–µ—Å–µ—Ç –ë–î (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
docker compose down -v
```

–ü–æ—Å–ª–µ —Ä–µ—Å–µ—Ç–∞ –ë–î –ø–æ–¥–Ω–∏–º–∏—Ç–µ —Å—Ç–µ–∫ –∑–∞–Ω–æ–≤–æ, —á—Ç–æ–±—ã baseline-–º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–ª–∞ —Å—Ö–µ–º—É:

```bash
docker compose up -d --build
```

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –Ω–∞–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —á–∏—Å—Ç—É—é –ë–î:

```bash
docker compose run --rm migrations
```

## –í–∞–∂–Ω–æ –ø—Ä–æ –∑–∞–ø—É—Å–∫ polling

- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Docker Compose.
- –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ `python -m app.main` –Ω–∞ —Ö–æ—Å—Ç–µ –≤–º–µ—Å—Ç–µ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º, –∏–Ω–∞—á–µ –≤–æ–∑–º–æ–∂–µ–Ω TelegramConflictError.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
- `‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑` ‚Äî –º–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏.
- `üìã –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤` ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç–æ—á–µ–∫.
- `üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ (—Ç–æ–ª—å–∫–æ SYS_ADMIN/SUPER_ADMIN).

## –ó–∞–º–µ—Ç–∫–∏

- –í—Å–µ ID/—Å–µ–∫—Ä–µ—Ç—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ `.env`.
- –ë–æ—Ç –ø—É–±–ª–∏–∫—É–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –≤ `REQUESTS_CHAT_ID`.
